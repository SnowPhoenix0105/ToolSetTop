# 用户中心数据库设计

## 需求

数据库主要保存的是需求分析中的`账户`实体，其分为两类：

1. 已注册账户；
2. 未注册账户；

对于一个已注册账户，主要需要保存以下信息：

1. uid：便于其它服务对用户进行标识；
2. 邮箱：用于登录；
3. 加密后的密码：用于登录；
4. 权限等级：`admin`或者`user`；

对一个未注册的账户，主要需要保存一下信息：

1. uid：便于其它服务对用户进行标识；
2. 过期时间；

对于未注册用户，权限等级必然是`passerrby`；

还需要保存用户的基本信息，如昵称、头像等。

## 表设计

需要存储的属性有：

1. uid：用户的唯一标识符；
2. name：昵称；
3. photo：头像；
4. auth：权限等级；
5. expire：过期时间；
6. email：邮箱；
7. bcrypt：加密后的密码；

所有属性都函数依赖于uid，可以组织为一张表，但其中expire、email、bcrypt都需要无效值。

* expire：因为可能通过该字段与当前时间的比较来删除，所以其无效值为最大值；
* email：因为需要建立unique索引，所以无效值应当为null；
* bcrypt：不需要索引，无效值为空字符串；

## 关系模式约束

|属性名|描述|基础类型|额外约束|
|:-|:-|:-|:-|
|uid|用户ID|int|主键，由数据库负责维护，递增|
|name|昵称|varchar(18)|备用键，不可重复|
|photo|头像|int||
|auth|权限等级|int|枚举值0-`passerby`，1-`user`，2-`admin`|
|expire|过期时间|datetime|已注册用户的该值应当为最大值|
|email|邮箱|varchar(254)|可为null，有效值不可重复，需要建立索引|
|bcrypt|加密后的密码|char(60)|采用Bcrypt算法时结果的长度是固定的|

